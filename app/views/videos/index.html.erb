<div class="container">
  <h1>Videos</h1>
  <% if user_signed_in? %>
    <%= link_to 'New Video', new_video_path %>
  <% else %>
  <% end %>

  <div class="row card-columns">
      <% @videos.each do |video| %>
      <div class="col-lg-4">
        <div class="card">
          <img src="http://i.ytimg.com/vi/<%= video.video_id %>/maxresdefault.jpg" class="card-img-top video-btn" alt="..." type="button" data-toggle="modal" data-src="<%= video.url %>" data-target="#videoModal">
          <div class="card-body">
            <h5 class="card-title"><%= video.title %></h5>
            <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
            <button type="button" class="btn btn-primary video-btn" data-toggle="modal" data-src="<%= video.url %>" data-target="#videoModal">
              Play Video
            </button>
            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
            <% if user_signed_in? %>
              <%= link_to 'Delete', video, method: :delete, data: { confirm: 'Are you sure?' } %>
              <br>
            <% else %>
            <% end %>
          </div>
        </div>
      </div>
      <% end %>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <!-- 16:9 aspect ratio -->
        <div class="embed-responsive embed-responsive-16by9">
          <iframe class="embed-responsive-item" src="" id="video"  allowscriptaccess="always" allow="autoplay"
          allowfullscreen="allowfullscreen"
          mozallowfullscreen="mozallowfullscreen"
          msallowfullscreen="msallowfullscreen"
          oallowfullscreen="oallowfullscreen"
          webkitallowfullscreen="webkitallowfullscreen"></iframe>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function() {

// Gets the video src from the data-src on each button

var $videoSrc;
$('.video-btn').click(function() {
    $videoSrc = $(this).data( "src" );
});
console.log($videoSrc);



// when the modal is opened autoplay it
$('#videoModal').on('shown.bs.modal', function (e) {

// set the video src to autoplay and not to show related video. Youtube related video is like a box of chocolates... you never know what you're gonna get
$("#video").attr('src',$videoSrc + "?autoplay=1&amp;modestbranding=1&amp;showinfo=0" );
})



// stop playing the youtube video when I close the modal
$('#videoModal').on('hide.bs.modal', function (e) {
    // a poor man's stop video
    $("#video").attr('src',$videoSrc);
})






// document ready
});

</script>
